<!DOCTYPE html>
<html>
<head>
    <title>Login Debug</title>
    <style>
        body { font-family: Arial; margin: 40px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; max-width: 600px; margin: 0 auto; }
        button { padding: 12px 24px; margin: 10px 5px; font-size: 16px; cursor: pointer; border: none; border-radius: 4px; }
        .test { background: #4CAF50; color: white; }
        .clear { background: #f44336; color: white; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        input { padding: 10px; width: 200px; margin: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Login Debug Tool</h1>
        <p>This page helps diagnose login issues with the Findemo app.</p>
        
        <h2>1. Test Backend Connection</h2>
        <button class="test" onclick="testHealth()">Test Backend Health</button>
        
        <h2>2. Test Login</h2>
        <div>
            <input type="text" id="username" value="demo" placeholder="Username">
            <input type="password" id="password" value="demo123" placeholder="Password">
        </div>
        <button class="test" onclick="testLogin()">Test Login</button>
        
        <h2>3. Test CORS Preflight</h2>
        <button class="test" onclick="testCORS()">Test CORS</button>
        
        <button class="clear" onclick="clearResults()">Clear Results</button>
        
        <h2>Results:</h2>
        <pre id="results">No tests run yet...</pre>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            results.innerHTML += `[${timestamp}] <span class="${className}">${message}</span>\n`;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = 'Results cleared.\n';
        }

        async function testHealth() {
            log('Testing backend health...');
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                log('‚úì Backend Health: ' + JSON.stringify(data), 'success');
            } catch (err) {
                log('‚úó Backend Health Failed: ' + err.message, 'error');
            }
        }

        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            log(`Testing login with ${username}/${password}...`);
            
            try {
                const response = await fetch('http://localhost:8000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                log(`Response status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úì LOGIN SUCCESS!', 'success');
                    log('Token received: ' + data.access_token.substring(0, 50) + '...', 'success');
                    log('Token type: ' + data.token_type, 'success');
                    localStorage.setItem('access_token', data.access_token);
                    log('‚úì Token saved to localStorage', 'success');
                } else {
                    const error = await response.text();
                    log('‚úó LOGIN FAILED: ' + error, 'error');
                }
            } catch (err) {
                log('‚úó Network/CORS Error: ' + err.message, 'error');
                log('This usually means CORS preflight failed', 'error');
            }
        }

        async function testCORS() {
            log('Testing CORS preflight (OPTIONS request)...');
            
            try {
                const response = await fetch('http://localhost:8000/login', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': 'http://localhost:5173',
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'content-type'
                    }
                });
                
                log(`OPTIONS response: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    log('‚úì CORS Preflight OK', 'success');
                } else {
                    log('‚úó CORS Preflight Failed', 'error');
                    log('Backend needs to allow OPTIONS requests', 'error');
                }
            } catch (err) {
                log('‚úó CORS Test Failed: ' + err.message, 'error');
            }
        }

        // Auto-run health check on load
        window.onload = () => {
            log('=== Findemo Login Debug Tool ===\n');
            testHealth();
        };
    </script>
</body>
</html>
